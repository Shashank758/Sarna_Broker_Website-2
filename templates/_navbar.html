<!-- ================= UNIFIED NAVBAR - SARNA MANDI ================= -->
<nav class="navbar navbar-expand-lg sarna-navbar">
  <div class="container">
    <!-- Brand -->
    <a class="navbar-brand" href="{% if session.role == 'admin' %}/admin{% elif session.role == 'miller' %}/miller{% elif session.role == 'buyer' %}/market{% else %}/market{% endif %}">
      <i class="fa fa-seedling"></i>
      <span>Sarna Mandi</span>
    </a>

    <!-- Mobile Toggle -->
    <button class="navbar-toggler" type="button"
            data-bs-toggle="collapse"
            data-bs-target="#sarnaNav"
            aria-controls="sarnaNav"
            aria-expanded="false">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navigation Links -->
    <div class="collapse navbar-collapse" id="sarnaNav">
      <ul class="navbar-nav ms-auto align-items-center">

        {% if session.role == 'buyer' %}
        <!-- ===== BUYER NAVIGATION ===== -->
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/market' %}active{% endif %}" href="/market">
            <i class="fa fa-store me-1"></i> Market
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/buyer/active' %}active{% endif %}" href="/buyer/active">
            <i class="fa fa-truck me-1"></i> Active
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/buyer/partial' %}active{% endif %}" href="/buyer/partial">
            <i class="fa fa-lock me-1"></i> Partial
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/buyer/loaded' %}active{% endif %}" href="/buyer/loaded">
            <i class="fa fa-check-circle me-1"></i> Loaded
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/buyer/payments' %}active{% endif %}" href="/buyer/payments">
            <i class="fa fa-money-bill me-1"></i> Payments
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/buyer/profile' %}active{% endif %}" href="/buyer/profile">
            <i class="fa fa-user me-1"></i> Profile
          </a>
        </li>

        {% elif session.role == 'miller' %}
        <!-- ===== MILLER NAVIGATION ===== -->
        {% if session.is_staff %}
        <li class="nav-item">
          <span class="nav-role-badge me-2">
            <i class="fa fa-user-shield me-1"></i> STAFF
          </span>
        </li>
        {% endif %}
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/miller' %}active{% endif %}" href="/miller">
            <i class="fa fa-gauge me-1"></i> Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/miller/approved' %}active{% endif %}" href="/miller/approved">
            <i class="fa fa-clock me-1"></i> Approved
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/miller/qc' %}active{% endif %}" href="/miller/qc">
            <i class="fa fa-clipboard-check me-1"></i> QC
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/miller/final-hisab' %}active{% endif %}" href="/miller/final-hisab">
            <i class="fa fa-file-invoice me-1"></i> Final Hisab
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/miller/payment-completed' %}active{% endif %}" href="/miller/payment-completed">
            <i class="fa fa-check-circle me-1"></i> Paid
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/miller/profile' %}active{% endif %}" href="/miller/profile">
            <i class="fa fa-user me-1"></i> Profile
          </a>
        </li>

        {% elif session.role == 'farmer' %}
        <!-- ===== FARMER NAVIGATION ===== -->
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/market' %}active{% endif %}" href="/market">
            <i class="fa fa-store me-1"></i> Market
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/my_commodity' %}active{% endif %}" href="/my_commodity">
            <i class="fa fa-seedling me-1"></i> My Crops
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/post_crop' %}active{% endif %}" href="/post_crop">
            <i class="fa fa-plus me-1"></i> Post Crop
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/profile' %}active{% endif %}" href="/profile">
            <i class="fa fa-user me-1"></i> Profile
          </a>
        </li>

        {% elif session.role == 'admin' %}
        <!-- ===== ADMIN NAVIGATION ===== -->
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/admin' %}active{% endif %}" href="/admin">
            <i class="fa fa-gauge me-1"></i> Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/admin/users' %}active{% endif %}" href="/admin/users">
            <i class="fa fa-users me-1"></i> Users
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/admin/stock' %}active{% endif %}" href="/admin/stock">
            <i class="fa fa-box me-1"></i> Stock
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.path == '/admin/bookings' %}active{% endif %}" href="/admin/bookings">
            <i class="fa fa-shopping-cart me-1"></i> Bookings
          </a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
            <i class="fa fa-ellipsis-h me-1"></i> More
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="/admin/compare"><i class="fa fa-balance-scale me-2"></i>Rate Compare</a></li>
            <li><a class="dropdown-item" href="/admin/stock-history"><i class="fa fa-history me-2"></i>Stock History</a></li>
            <li><a class="dropdown-item" href="/admin/miller-profiles"><i class="fa fa-industry me-2"></i>Miller Profiles</a></li>
            <li><a class="dropdown-item" href="/admin/buyer-profiles"><i class="fa fa-store me-2"></i>Buyer Profiles</a></li>
          </ul>
        </li>

        {% else %}
        <!-- ===== DEFAULT / GUEST NAVIGATION ===== -->
        <li class="nav-item">
          <a class="nav-link" href="/market">
            <i class="fa fa-store me-1"></i> Market
          </a>
        </li>
        {% endif %}

        <!-- ===== LOGOUT (for all logged-in users) ===== -->
        {% if session.user_id %}
        <li class="nav-item ms-2">
          <a class="nav-link" href="/logout" style="color: rgba(255,255,255,0.8) !important;">
            <i class="fa fa-right-from-bracket me-1"></i> Logout
          </a>
        </li>
        {% endif %}

      </ul>
    </div>
  </div>
</nav>
